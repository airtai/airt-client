
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Python client for airt-service">
      
      
        <meta name="author" content="airt.ai">
      
      
        <link rel="canonical" href="https://airtai.github.io/airt-client/CLI_Key/">
      
      
      
      <link rel="icon" href="../overrides/images/airt_icon_blue.svg">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.18">
    
    
      
        <title>CLI_Key - airt</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.26e3688c.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../overrides/css/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-H6EV08GRK5"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-H6EV08GRK5",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-H6EV08GRK5",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>

  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  
  
    
  
  
  <meta property="og:type" content="website" />
  <meta property="og:title" content="airt - CLI_Key" />
  <meta property="og:description" content="Python client for airt-service" />
  <meta property="og:url" content="https://airtai.github.io/airt-client/CLI_Key/" />
  <meta property="og:image" content="https://opengraph.githubassets.com/1671820337.584456/airtai/airt-client" />
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="airt - CLI_Key" />
  <meta name="twitter:description" content="Python client for airt-service" />
  <meta name="twitter:image" content="https://opengraph.githubassets.com/1671820337.584456/airtai/airt-client" />

  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="light-blue">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cli_key" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="airt" class="md-header__button md-logo" aria-label="airt" data-md-component="logo">
      
  <img src="../overrides/images/airt_icon_blue.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            airt
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              CLI_Key
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="light-blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="light-blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/airtai/airt-client" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    airt-client
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="airt" class="md-nav__button md-logo" aria-label="airt" data-md-component="logo">
      
  <img src="../overrides/images/airt_icon_blue.svg" alt="logo">

    </a>
    airt
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/airtai/airt-client" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    airt-client
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Python client for airt service
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Tutorial/" class="md-nav__link">
        Tutorial
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../airt_api_docs/airt/client/" class="md-nav__link">
        airt.client
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          CLI
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          CLI
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../airt_cli_docs/airt/" class="md-nav__link">
        airt
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../CHANGELOG/" class="md-nav__link">
        Releases
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="cli_key">CLI_Key<a class="headerlink" href="#cli_key" title="Permanent link">Â¤</a></h1>
<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">airt._testing</span> <span class="kn">import</span> <span class="n">activate_by_import</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>[INFO] airt.testing.activate_by_import: Testing environment activated.
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>

<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">typer.testing</span> <span class="kn">import</span> <span class="n">CliRunner</span>

<span class="kn">import</span> <span class="nn">airt._sanitizer</span>
<span class="kn">from</span> <span class="nn">airt._cli.user</span> <span class="kn">import</span> <span class="n">app</span> <span class="k">as</span> <span class="n">user_cli_app</span>
<span class="kn">from</span> <span class="nn">airt._constant</span> <span class="kn">import</span> <span class="n">SERVICE_PASSWORD</span><span class="p">,</span> <span class="n">SERVICE_TOKEN</span><span class="p">,</span> <span class="n">SERVICE_USERNAME</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">RANDOM_UUID_FOR_TESTING</span> <span class="o">=</span> <span class="s2">&quot;00000000-0000-0000-0000-000000000000&quot;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">assert</span> <span class="s2">&quot;**AIRT_SERVICE_TOKEN**&quot;</span> <span class="ow">in</span> <span class="n">app</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">help</span>
<span class="k">assert</span> <span class="s2">&quot;airt services with it&quot;</span> <span class="ow">in</span> <span class="n">app</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">help</span>
<span class="k">assert</span> <span class="s2">&quot;**airt api-key**&quot;</span> <span class="ow">in</span> <span class="n">app</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">help</span>

<span class="n">app</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">help</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>&#39;A set of commands for managing the ApiKeys in the server.\n        \n        Both the ApiKey and the token can be used for accessing the airt services. However, there is a \n        slight difference in generating and managing the two.\n        \n        For generating the ApiKey, you first need to get the developer token. Please refer to **airt token** command documentation to generate one.\n        \n        After logging in with your developer token, you can create any number of new ApiKeys and can set an \n        expiration date individually. You can also access other commands available as part of **airt api-key** sub-command to \n        list, revoke the ApiKeys at any time.\n\n        Once the new API key is generated, please set it in the **AIRT_SERVICE_TOKEN** environment variable to start accessing the airt services with it.&#39;
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">runner</span> <span class="o">=</span> <span class="n">CliRunner</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">set_level</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Testing logger settings</span>

<span class="n">display</span><span class="p">(</span><span class="n">logger</span><span class="o">.</span><span class="n">getEffectiveLevel</span><span class="p">())</span>
<span class="k">assert</span> <span class="n">logger</span><span class="o">.</span><span class="n">getEffectiveLevel</span><span class="p">()</span> <span class="o">==</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span>

<span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;This is a debug message&quot;</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;This is an info&quot;</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;This is a warning&quot;</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;This is an error&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>30

[WARNING] __main__: This is a warning
[ERROR] __main__: This is an error
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Helper context manager for testing</span>

<span class="n">_airt_service_token</span> <span class="o">=</span> <span class="kc">None</span>


<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">set_airt_service_token_envvar</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">_airt_service_token</span>
    <span class="k">if</span> <span class="n">_airt_service_token</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">display</span><span class="p">(</span><span class="s2">&quot;_airt_service_token is None, getting a token...&quot;</span><span class="p">)</span>

        <span class="n">username</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">SERVICE_USERNAME</span><span class="p">]</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">SERVICE_PASSWORD</span><span class="p">]</span>

        <span class="n">Client</span><span class="o">.</span><span class="n">get_token</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
        <span class="n">_airt_service_token</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="n">auth_token</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">SERVICE_TOKEN</span><span class="p">]</span> <span class="o">=</span> <span class="n">_airt_service_token</span>

        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">SERVICE_TOKEN</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">set_airt_service_token_envvar</span><span class="p">():</span>
    <span class="n">display</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">((</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">SERVICE_TOKEN</span><span class="p">])))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>&#39;_airt_service_token is None, getting a token...&#39;

&#39;*******************************************************************************************************************************&#39;
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Tests for APIKey create</span>

<span class="c1"># Testing negative scenario</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
    <span class="n">app</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="s2">&quot;-e&quot;</span><span class="p">,</span> <span class="mi">365</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
<span class="k">assert</span> <span class="sa">f</span><span class="s2">&quot;KeyError: The environment variable &#39;</span><span class="si">{</span><span class="n">SERVICE_TOKEN</span><span class="si">}</span><span class="s2">&#39; is not set.&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span>
    <span class="n">result</span><span class="o">.</span><span class="n">stdout</span>
<span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>&quot;KeyError: The environment variable &#39;AIRT_SERVICE_TOKEN&#39; is not set.\n\nPlease run the command &#39;airt token&#39; to get the application token and set it in the environment variable `AIRT_SERVICE_TOKEN`.\n\nTry &#39;airt token --help&#39; for help.\n&quot;
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">generate_random_name</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">chars</span><span class="o">=</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_uppercase</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>


<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">generate_random_name</span><span class="p">())</span> <span class="o">==</span> <span class="mi">15</span>
<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">generate_random_name</span><span class="p">())</span> <span class="o">==</span> <span class="nb">str</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Tests for APIKey create</span>

<span class="c1"># Testing positive scenario and negative scenario</span>


<span class="k">def</span> <span class="nf">mask</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>


<span class="n">key_name</span> <span class="o">=</span> <span class="n">generate_random_name</span><span class="p">()</span>
<span class="k">with</span> <span class="n">set_airt_service_token_envvar</span><span class="p">():</span>
    <span class="c1"># Testing without quite flag</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
        <span class="n">app</span><span class="p">,</span>
        <span class="p">[</span><span class="n">key_name</span><span class="p">,</span> <span class="s2">&quot;-e&quot;</span><span class="p">,</span> <span class="mi">365</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="n">access_token</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">masked_token</span> <span class="o">=</span> <span class="n">mask</span><span class="p">(</span><span class="n">access_token</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;: &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">display</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">masked_token</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">access_token</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">127</span>  <span class="c1"># maybe</span>
    <span class="k">assert</span> <span class="s2">&quot;Access Token&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

    <span class="c1"># Testing with quite flag</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
        <span class="n">app</span><span class="p">,</span>
        <span class="p">[</span><span class="n">generate_random_name</span><span class="p">(),</span> <span class="s2">&quot;-e&quot;</span><span class="p">,</span> <span class="mi">365</span><span class="p">,</span> <span class="s2">&quot;-q&quot;</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="n">access_token</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">masked_token</span> <span class="o">=</span> <span class="n">mask</span><span class="p">(</span><span class="n">access_token</span><span class="p">)</span>

    <span class="n">display</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">masked_token</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">access_token</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">127</span>  <span class="c1"># maybe</span>
    <span class="k">assert</span> <span class="s2">&quot;Access Token&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

    <span class="c1"># Negative scenario: Creating key without setting expiration date</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
        <span class="n">app</span><span class="p">,</span>
        <span class="p">[</span><span class="n">generate_random_name</span><span class="p">(),</span> <span class="s2">&quot;-q&quot;</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="n">access_token</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">masked_token</span> <span class="o">=</span> <span class="n">mask</span><span class="p">(</span><span class="n">access_token</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">masked_token</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">access_token</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">110</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">access_token</span><span class="p">)</span>  <span class="c1"># maybe</span>
    <span class="k">assert</span> <span class="s2">&quot;Access Token&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

    <span class="c1"># Negative scenario: Passing existing key name</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
        <span class="n">app</span><span class="p">,</span>
        <span class="p">[</span><span class="n">key_name</span><span class="p">,</span> <span class="s2">&quot;-e&quot;</span><span class="p">,</span> <span class="mi">365</span><span class="p">,</span> <span class="s2">&quot;-q&quot;</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">assert</span> <span class="s2">&quot;An Api-key with the same name already exists&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

    <span class="c1"># Negative scenario: Passing OTP for non-mfa user existing key name</span>
    <span class="n">random_otp</span> <span class="o">=</span> <span class="s2">&quot;123456&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
        <span class="n">app</span><span class="p">,</span>
        <span class="p">[</span><span class="n">generate_random_name</span><span class="p">(),</span> <span class="s2">&quot;-e&quot;</span><span class="p">,</span> <span class="mi">365</span><span class="p">,</span> <span class="s2">&quot;-q&quot;</span><span class="p">,</span> <span class="s2">&quot;--otp&quot;</span><span class="p">,</span> <span class="n">random_otp</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">assert</span> <span class="s2">&quot;MFA is not activated for the account&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>&quot;masked_token=&#39;*************************************************************************************************************************************************************************************************&#39;&quot;

&quot;masked_token=&#39;*************************************************************************************************************************************************************************************************&#39;&quot;

&quot;masked_token=&#39;***************************************************************************************************************************************************************************&#39;&quot;

&#39;Error: An Api-key with the same name already exists\n&#39;

&#39;Error: MFA is not activated for the account. Please pass the OTP only after activating the MFA for your account.\n&#39;
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Tests for APIKey ls</span>


<span class="c1"># Testing positive scenario</span>
<span class="k">def</span> <span class="nf">get_values_from_result</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)]</span>


<span class="k">with</span> <span class="n">set_airt_service_token_envvar</span><span class="p">():</span>
    <span class="c1"># Testing without quite flag</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ls&quot;</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">0</span>

    <span class="c1"># With quiet</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ls&quot;</span><span class="p">,</span> <span class="s2">&quot;-q&quot;</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="n">ids</span> <span class="o">=</span> <span class="n">get_values_from_result</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>&#39;uuid                                  name             created         expiry              disabled\n76a90be6-4535-4c70-ac2a-16df432913ca  RKO4OSLE9DITOFO  24 minutes ago  None                False\n35a317ad-0fa1-4e76-ab36-d60a9a31c235  7XIE331PO1OWE71  24 minutes ago  5 months ago        False\n6146ab3a-a49b-4ae3-a628-b6a31583b2d2  DNAK3ICMGDAFQ1K  24 minutes ago  None                False\n3cc3ff1c-374a-4090-bb78-742e5b3aef0a  8TMEGHX4WXTDGJZ  24 minutes ago  None                False\n510edef2-244c-49c8-b8f5-b2c3b500c51b  YT9B6CT1797HNYP  24 minutes ago  None                False\ne4946c54-756e-4e74-9db5-22270bd1c025  SFFJK74O7N32MOR  24 minutes ago  None                False\n4313caa8-8faa-42ab-8f46-bd6669d96aad  IBK7RGHPPG05S4X  24 minutes ago  None                False\n6ad2a881-bfad-4acb-9d0b-13650e161051  R9JBTBYQF74FSVT  24 minutes ago  None                False\na7bfc801-649e-4574-997f-0dc57bd4e8b5  2BO0JKANPJ46HID  24 minutes ago  None                False\n00d6b61a-62f9-425a-a514-6383b9ffb392  28YDMEXXMUSANLT  24 minutes ago  None                False\n6e68750d-7c2b-49f4-b2fb-0c3795ec4a32  I9EMJL0SJ919UEX  24 minutes ago  None                False\n78837644-436a-4e4f-82d0-c875d8a72437  JBCQS7CWVT4GM30  24 minutes ago  None                False\n835281e3-c2e1-48aa-b9d6-1e39a5f4935e  A1N6OAMDI597IYE  24 minutes ago  None                False\n92b2f7d5-810c-4cb0-b793-2d8932ded032  89HJKCDZUSVQQLS  now             11 months from now  False\na2eaa375-a21e-47cb-8e84-eb430da6c280  MF9MJAGCT1SEBKO  now             11 months from now  False\n10af3501-3cbb-4735-83e7-db058746efbd  5STC1FGTHT0BB8K  now             None                False\n&#39;

&#39;76a90be6-4535-4c70-ac2a-16df432913ca\n35a317ad-0fa1-4e76-ab36-d60a9a31c235\n6146ab3a-a49b-4ae3-a628-b6a31583b2d2\n3cc3ff1c-374a-4090-bb78-742e5b3aef0a\n510edef2-244c-49c8-b8f5-b2c3b500c51b\ne4946c54-756e-4e74-9db5-22270bd1c025\n4313caa8-8faa-42ab-8f46-bd6669d96aad\n6ad2a881-bfad-4acb-9d0b-13650e161051\na7bfc801-649e-4574-997f-0dc57bd4e8b5\n00d6b61a-62f9-425a-a514-6383b9ffb392\n6e68750d-7c2b-49f4-b2fb-0c3795ec4a32\n78837644-436a-4e4f-82d0-c875d8a72437\n835281e3-c2e1-48aa-b9d6-1e39a5f4935e\n92b2f7d5-810c-4cb0-b793-2d8932ded032\na2eaa375-a21e-47cb-8e84-eb430da6c280\n10af3501-3cbb-4735-83e7-db058746efbd\n&#39;
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Tests for APIKey ls</span>
<span class="c1"># Tests using --format flag</span>

<span class="k">with</span> <span class="n">set_airt_service_token_envvar</span><span class="p">():</span>
    <span class="c1"># Testing format flag</span>
    <span class="n">format_str</span> <span class="o">=</span> <span class="s2">&quot;{&#39;name&#39;: &#39;</span><span class="si">{}</span><span class="s2">&#39;}&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ls&quot;</span><span class="p">,</span> <span class="s2">&quot;--format&quot;</span><span class="p">,</span> <span class="n">format_str</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
    <span class="n">key_names</span> <span class="o">=</span> <span class="n">get_values_from_result</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">key_names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="c1"># Testing format flag</span>
    <span class="n">format_str</span> <span class="o">=</span> <span class="s2">&quot;{&#39;name&#39;: &#39;</span><span class="si">{}</span><span class="s2">&#39;, &#39;uuid&#39;: &#39;</span><span class="si">{}</span><span class="s2">&#39;}&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ls&quot;</span><span class="p">,</span> <span class="s2">&quot;--format&quot;</span><span class="p">,</span> <span class="n">format_str</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">0</span>

    <span class="c1"># Testing format flag</span>
    <span class="n">format_str</span> <span class="o">=</span> <span class="s2">&quot;{&#39;names&#39;: &#39;</span><span class="si">{}</span><span class="s2">&#39;}&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ls&quot;</span><span class="p">,</span> <span class="s2">&quot;--format&quot;</span><span class="p">,</span> <span class="n">format_str</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">assert</span> <span class="s2">&quot;The following columns are not valid&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>&#39;RKO4OSLE9DITOFO\n7XIE331PO1OWE71\nDNAK3ICMGDAFQ1K\n8TMEGHX4WXTDGJZ\nYT9B6CT1797HNYP\nSFFJK74O7N32MOR\nIBK7RGHPPG05S4X\nR9JBTBYQF74FSVT\n2BO0JKANPJ46HID\n28YDMEXXMUSANLT\nI9EMJL0SJ919UEX\nJBCQS7CWVT4GM30\nA1N6OAMDI597IYE\n89HJKCDZUSVQQLS\nMF9MJAGCT1SEBKO\n5STC1FGTHT0BB8K\n&#39;

&#39;name             uuid\nRKO4OSLE9DITOFO  76a90be6-4535-4c70-ac2a-16df432913ca\n7XIE331PO1OWE71  35a317ad-0fa1-4e76-ab36-d60a9a31c235\nDNAK3ICMGDAFQ1K  6146ab3a-a49b-4ae3-a628-b6a31583b2d2\n8TMEGHX4WXTDGJZ  3cc3ff1c-374a-4090-bb78-742e5b3aef0a\nYT9B6CT1797HNYP  510edef2-244c-49c8-b8f5-b2c3b500c51b\nSFFJK74O7N32MOR  e4946c54-756e-4e74-9db5-22270bd1c025\nIBK7RGHPPG05S4X  4313caa8-8faa-42ab-8f46-bd6669d96aad\nR9JBTBYQF74FSVT  6ad2a881-bfad-4acb-9d0b-13650e161051\n2BO0JKANPJ46HID  a7bfc801-649e-4574-997f-0dc57bd4e8b5\n28YDMEXXMUSANLT  00d6b61a-62f9-425a-a514-6383b9ffb392\nI9EMJL0SJ919UEX  6e68750d-7c2b-49f4-b2fb-0c3795ec4a32\nJBCQS7CWVT4GM30  78837644-436a-4e4f-82d0-c875d8a72437\nA1N6OAMDI597IYE  835281e3-c2e1-48aa-b9d6-1e39a5f4935e\n89HJKCDZUSVQQLS  92b2f7d5-810c-4cb0-b793-2d8932ded032\nMF9MJAGCT1SEBKO  a2eaa375-a21e-47cb-8e84-eb430da6c280\n5STC1FGTHT0BB8K  10af3501-3cbb-4735-83e7-db058746efbd\n&#39;

&quot;The following columns are not valid: {&#39;names&#39;}. Only the following columns are valid: {&#39;disabled&#39;, &#39;uuid&#39;, &#39;created&#39;, &#39;name&#39;, &#39;expiry&#39;}\nAn example of a valid formatting string: {&#39;uuid&#39;: &#39;{}&#39;, &#39;name&#39;: &#39;{}&#39;, &#39;created&#39;: &#39;{}&#39;, &#39;expiry&#39;: &#39;{}&#39;, &#39;disabled&#39;: &#39;{}&#39;}\n&quot;
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Tests for APIKeys ls</span>
<span class="c1"># Testing positive scenario.</span>
<span class="c1"># Testing by passing different values for  limit</span>


<span class="k">with</span> <span class="n">set_airt_service_token_envvar</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">limit</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]:</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ls&quot;</span><span class="p">,</span> <span class="s2">&quot;--offset&quot;</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="s2">&quot;--limit&quot;</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="s2">&quot;-q&quot;</span><span class="p">])</span>

        <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">0</span>

        <span class="n">ids</span> <span class="o">=</span> <span class="n">get_values_from_result</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="n">display</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ids</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">limit</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>&quot;ids=[&#39;35a317ad-0fa1-4e76-ab36-d60a9a31c235&#39;]&quot;

&quot;ids=[&#39;35a317ad-0fa1-4e76-ab36-d60a9a31c235&#39;, &#39;6146ab3a-a49b-4ae3-a628-b6a31583b2d2&#39;, &#39;3cc3ff1c-374a-4090-bb78-742e5b3aef0a&#39;, &#39;510edef2-244c-49c8-b8f5-b2c3b500c51b&#39;, &#39;e4946c54-756e-4e74-9db5-22270bd1c025&#39;, &#39;4313caa8-8faa-42ab-8f46-bd6669d96aad&#39;, &#39;6ad2a881-bfad-4acb-9d0b-13650e161051&#39;, &#39;a7bfc801-649e-4574-997f-0dc57bd4e8b5&#39;, &#39;00d6b61a-62f9-425a-a514-6383b9ffb392&#39;, &#39;6e68750d-7c2b-49f4-b2fb-0c3795ec4a32&#39;]&quot;

&quot;ids=[&#39;35a317ad-0fa1-4e76-ab36-d60a9a31c235&#39;, &#39;6146ab3a-a49b-4ae3-a628-b6a31583b2d2&#39;, &#39;3cc3ff1c-374a-4090-bb78-742e5b3aef0a&#39;, &#39;510edef2-244c-49c8-b8f5-b2c3b500c51b&#39;, &#39;e4946c54-756e-4e74-9db5-22270bd1c025&#39;, &#39;4313caa8-8faa-42ab-8f46-bd6669d96aad&#39;, &#39;6ad2a881-bfad-4acb-9d0b-13650e161051&#39;, &#39;a7bfc801-649e-4574-997f-0dc57bd4e8b5&#39;, &#39;00d6b61a-62f9-425a-a514-6383b9ffb392&#39;, &#39;6e68750d-7c2b-49f4-b2fb-0c3795ec4a32&#39;, &#39;78837644-436a-4e4f-82d0-c875d8a72437&#39;, &#39;835281e3-c2e1-48aa-b9d6-1e39a5f4935e&#39;, &#39;92b2f7d5-810c-4cb0-b793-2d8932ded032&#39;, &#39;a2eaa375-a21e-47cb-8e84-eb430da6c280&#39;, &#39;10af3501-3cbb-4735-83e7-db058746efbd&#39;]&quot;
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Tests for APIKeys ls</span>
<span class="c1"># Testing positive scenario.</span>
<span class="c1"># Testing by passing large value for offset.</span>

<span class="k">with</span> <span class="n">set_airt_service_token_envvar</span><span class="p">():</span>
    <span class="n">limit</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="mi">1_000_000</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ls&quot;</span><span class="p">,</span> <span class="s2">&quot;--offset&quot;</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="s2">&quot;--limit&quot;</span><span class="p">,</span> <span class="n">limit</span><span class="p">])</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">0</span>

    <span class="n">display</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>&#39;uuid    name    created    expiry    disabled\n&#39;
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Helper context manager for testing</span>

<span class="n">_airt_super_service_token</span> <span class="o">=</span> <span class="kc">None</span>


<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">set_airt_super_service_token_envvar</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">_airt_super_service_token</span>
    <span class="k">if</span> <span class="n">_airt_super_service_token</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">display</span><span class="p">(</span><span class="s2">&quot;_airt_super_service_token is None, getting a token...&quot;</span><span class="p">)</span>

        <span class="n">username</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;AIRT_SERVICE_SUPER_USER&quot;</span><span class="p">]</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">SERVICE_PASSWORD</span><span class="p">]</span>

        <span class="n">Client</span><span class="o">.</span><span class="n">get_token</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
        <span class="n">_airt_super_service_token</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="n">auth_token</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">SERVICE_TOKEN</span><span class="p">]</span> <span class="o">=</span> <span class="n">_airt_super_service_token</span>

        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">SERVICE_TOKEN</span><span class="p">]</span>


<span class="k">with</span> <span class="n">set_airt_super_service_token_envvar</span><span class="p">():</span>
    <span class="n">display</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">((</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">SERVICE_TOKEN</span><span class="p">])))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>&#39;_airt_super_service_token is None, getting a token...&#39;

&#39;*******************************************************************************************************************************&#39;
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Tests for APIKey ls</span>

<span class="k">with</span> <span class="n">set_airt_service_token_envvar</span><span class="p">():</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">user_cli_app</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;details&quot;</span><span class="p">,</span> <span class="s2">&quot;-q&quot;</span><span class="p">])</span>
    <span class="n">other_user_uuid</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">other_user_uuid</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
        <span class="n">user_cli_app</span><span class="p">,</span>
        <span class="p">[</span><span class="s2">&quot;details&quot;</span><span class="p">,</span> <span class="s2">&quot;--user&quot;</span><span class="p">,</span> <span class="n">other_user_uuid</span><span class="p">,</span> <span class="s2">&quot;--format&quot;</span><span class="p">,</span> <span class="s2">&quot;{&#39;username&#39;: &#39;</span><span class="si">{}</span><span class="s2">&#39;}&quot;</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="n">other_user_name</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Testing Super user scenarios</span>
<span class="k">with</span> <span class="n">set_airt_super_service_token_envvar</span><span class="p">():</span>
    <span class="c1"># Testing without quite flag</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ls&quot;</span><span class="p">,</span> <span class="s2">&quot;--user&quot;</span><span class="p">,</span> <span class="n">other_user_uuid</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">0</span>

    <span class="c1"># With quiet</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ls&quot;</span><span class="p">,</span> <span class="s2">&quot;-q&quot;</span><span class="p">,</span> <span class="s2">&quot;--user&quot;</span><span class="p">,</span> <span class="n">other_user_name</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="n">ids</span> <span class="o">=</span> <span class="n">get_values_from_result</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ids</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>&#39;d12065d3-48cb-4632-a4cc-db11b843399a&#39;

&#39;uuid                                  name             created         expiry              disabled\n76a90be6-4535-4c70-ac2a-16df432913ca  RKO4OSLE9DITOFO  24 minutes ago  None                False\n35a317ad-0fa1-4e76-ab36-d60a9a31c235  7XIE331PO1OWE71  24 minutes ago  5 months ago        False\n6146ab3a-a49b-4ae3-a628-b6a31583b2d2  DNAK3ICMGDAFQ1K  24 minutes ago  None                False\n3cc3ff1c-374a-4090-bb78-742e5b3aef0a  8TMEGHX4WXTDGJZ  24 minutes ago  None                False\n510edef2-244c-49c8-b8f5-b2c3b500c51b  YT9B6CT1797HNYP  24 minutes ago  None                False\ne4946c54-756e-4e74-9db5-22270bd1c025  SFFJK74O7N32MOR  24 minutes ago  None                False\n4313caa8-8faa-42ab-8f46-bd6669d96aad  IBK7RGHPPG05S4X  24 minutes ago  None                False\n6ad2a881-bfad-4acb-9d0b-13650e161051  R9JBTBYQF74FSVT  24 minutes ago  None                False\na7bfc801-649e-4574-997f-0dc57bd4e8b5  2BO0JKANPJ46HID  24 minutes ago  None                False\n00d6b61a-62f9-425a-a514-6383b9ffb392  28YDMEXXMUSANLT  24 minutes ago  None                False\n6e68750d-7c2b-49f4-b2fb-0c3795ec4a32  I9EMJL0SJ919UEX  24 minutes ago  None                False\n78837644-436a-4e4f-82d0-c875d8a72437  JBCQS7CWVT4GM30  24 minutes ago  None                False\n835281e3-c2e1-48aa-b9d6-1e39a5f4935e  A1N6OAMDI597IYE  24 minutes ago  None                False\n92b2f7d5-810c-4cb0-b793-2d8932ded032  89HJKCDZUSVQQLS  a second ago    11 months from now  False\na2eaa375-a21e-47cb-8e84-eb430da6c280  MF9MJAGCT1SEBKO  a second ago    11 months from now  False\n10af3501-3cbb-4735-83e7-db058746efbd  5STC1FGTHT0BB8K  a second ago    None                False\n&#39;

&#39;76a90be6-4535-4c70-ac2a-16df432913ca\n35a317ad-0fa1-4e76-ab36-d60a9a31c235\n6146ab3a-a49b-4ae3-a628-b6a31583b2d2\n3cc3ff1c-374a-4090-bb78-742e5b3aef0a\n510edef2-244c-49c8-b8f5-b2c3b500c51b\ne4946c54-756e-4e74-9db5-22270bd1c025\n4313caa8-8faa-42ab-8f46-bd6669d96aad\n6ad2a881-bfad-4acb-9d0b-13650e161051\na7bfc801-649e-4574-997f-0dc57bd4e8b5\n00d6b61a-62f9-425a-a514-6383b9ffb392\n6e68750d-7c2b-49f4-b2fb-0c3795ec4a32\n78837644-436a-4e4f-82d0-c875d8a72437\n835281e3-c2e1-48aa-b9d6-1e39a5f4935e\n92b2f7d5-810c-4cb0-b793-2d8932ded032\na2eaa375-a21e-47cb-8e84-eb430da6c280\n10af3501-3cbb-4735-83e7-db058746efbd\n&#39;

&quot;ids=[&#39;76a90be6-4535-4c70-ac2a-16df432913ca&#39;, &#39;35a317ad-0fa1-4e76-ab36-d60a9a31c235&#39;, &#39;6146ab3a-a49b-4ae3-a628-b6a31583b2d2&#39;, &#39;3cc3ff1c-374a-4090-bb78-742e5b3aef0a&#39;, &#39;510edef2-244c-49c8-b8f5-b2c3b500c51b&#39;, &#39;e4946c54-756e-4e74-9db5-22270bd1c025&#39;, &#39;4313caa8-8faa-42ab-8f46-bd6669d96aad&#39;, &#39;6ad2a881-bfad-4acb-9d0b-13650e161051&#39;, &#39;a7bfc801-649e-4574-997f-0dc57bd4e8b5&#39;, &#39;00d6b61a-62f9-425a-a514-6383b9ffb392&#39;, &#39;6e68750d-7c2b-49f4-b2fb-0c3795ec4a32&#39;, &#39;78837644-436a-4e4f-82d0-c875d8a72437&#39;, &#39;835281e3-c2e1-48aa-b9d6-1e39a5f4935e&#39;, &#39;92b2f7d5-810c-4cb0-b793-2d8932ded032&#39;, &#39;a2eaa375-a21e-47cb-8e84-eb430da6c280&#39;, &#39;10af3501-3cbb-4735-83e7-db058746efbd&#39;]&quot;
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># tests for APIKey details</span>
<span class="k">with</span> <span class="n">set_airt_service_token_envvar</span><span class="p">():</span>
    <span class="c1"># List the existing API Keys</span>
    <span class="n">format_str</span> <span class="o">=</span> <span class="s2">&quot;{&#39;name&#39;: &#39;</span><span class="si">{}</span><span class="s2">&#39;}&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ls&quot;</span><span class="p">,</span> <span class="s2">&quot;--format&quot;</span><span class="p">,</span> <span class="n">format_str</span><span class="p">])</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="n">key_names</span> <span class="o">=</span> <span class="n">get_values_from_result</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="c1"># Get details for the first API Key</span>
    <span class="n">first_key</span> <span class="o">=</span> <span class="n">key_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;details&quot;</span><span class="p">,</span> <span class="n">first_key</span><span class="p">])</span>

    <span class="n">display</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">0</span>

    <span class="c1"># Get details for the first API Key</span>
    <span class="n">first_key</span> <span class="o">=</span> <span class="n">key_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">format_str</span> <span class="o">=</span> <span class="s2">&quot;{&#39;name&#39;: &#39;</span><span class="si">{}</span><span class="s2">&#39;}&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;details&quot;</span><span class="p">,</span> <span class="n">first_key</span><span class="p">,</span> <span class="s2">&quot;--format&quot;</span><span class="p">,</span> <span class="n">format_str</span><span class="p">])</span>

    <span class="n">display</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">0</span>

    <span class="c1"># Get details for the first API Key</span>
    <span class="n">first_key</span> <span class="o">=</span> <span class="n">key_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">format_str</span> <span class="o">=</span> <span class="s2">&quot;{&#39;name&#39;: &#39;</span><span class="si">{}</span><span class="s2">&#39;, &#39;uuid&#39;: &#39;</span><span class="si">{}</span><span class="s2">&#39;}&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;details&quot;</span><span class="p">,</span> <span class="n">first_key</span><span class="p">,</span> <span class="s2">&quot;--format&quot;</span><span class="p">,</span> <span class="n">format_str</span><span class="p">])</span>

    <span class="n">display</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">0</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>&#39;uuid                                  name             created         expiry    disabled\n76a90be6-4535-4c70-ac2a-16df432913ca  RKO4OSLE9DITOFO  24 minutes ago  None      False\n&#39;

&#39;RKO4OSLE9DITOFO\n&#39;

&#39;name             uuid\nRKO4OSLE9DITOFO  76a90be6-4535-4c70-ac2a-16df432913ca\n&#39;
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Tests for details</span>
<span class="c1"># Testing negative scenario. Passing invalie API key id</span>

<span class="k">with</span> <span class="n">set_airt_service_token_envvar</span><span class="p">():</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;details&quot;</span><span class="p">,</span> <span class="n">RANDOM_UUID_FOR_TESTING</span><span class="p">])</span>

    <span class="n">display</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">assert</span> <span class="s2">&quot;No such apikey&quot;</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>&#39;Error: No such apikey or not enough authorization to access the apikey.\n&#39;
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># tests for APIKey revoke</span>
<span class="c1"># revoking key by name and id</span>

<span class="k">with</span> <span class="n">set_airt_service_token_envvar</span><span class="p">():</span>
    <span class="c1"># List the existing API Keys</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ls&quot;</span><span class="p">,</span> <span class="s2">&quot;-q&quot;</span><span class="p">])</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="n">key_ids</span> <span class="o">=</span> <span class="n">get_values_from_result</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="c1"># List the existing API Keys</span>
    <span class="n">format_str</span> <span class="o">=</span> <span class="s2">&quot;{&#39;name&#39;: &#39;</span><span class="si">{}</span><span class="s2">&#39;}&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ls&quot;</span><span class="p">,</span> <span class="s2">&quot;--format&quot;</span><span class="p">,</span> <span class="n">format_str</span><span class="p">])</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="n">key_names</span> <span class="o">=</span> <span class="n">get_values_from_result</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="c1"># Revoking the first API Key</span>
    <span class="n">format_str</span> <span class="o">=</span> <span class="s2">&quot;{&#39;name&#39;: &#39;</span><span class="si">{}</span><span class="s2">&#39;, &#39;uuid&#39;: &#39;</span><span class="si">{}</span><span class="s2">&#39;}&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
        <span class="n">app</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;revoke&quot;</span><span class="p">,</span> <span class="n">key_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">key_names</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">key_names</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;--format&quot;</span><span class="p">,</span> <span class="n">format_str</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="n">display</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">0</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>&#39;name             uuid\nRKO4OSLE9DITOFO  76a90be6-4535-4c70-ac2a-16df432913ca\n7XIE331PO1OWE71  35a317ad-0fa1-4e76-ab36-d60a9a31c235\nDNAK3ICMGDAFQ1K  6146ab3a-a49b-4ae3-a628-b6a31583b2d2\n&#39;
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># tests for APIKey revoke</span>
<span class="k">with</span> <span class="n">set_airt_service_token_envvar</span><span class="p">():</span>
    <span class="c1"># Create sample keys</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
            <span class="n">app</span><span class="p">,</span>
            <span class="p">[</span><span class="s2">&quot;create&quot;</span><span class="p">,</span> <span class="n">generate_random_name</span><span class="p">(),</span> <span class="s2">&quot;-e&quot;</span><span class="p">,</span> <span class="mi">365</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="c1"># List the existing API Keys</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ls&quot;</span><span class="p">,</span> <span class="s2">&quot;-q&quot;</span><span class="p">])</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="n">ids</span> <span class="o">=</span> <span class="n">get_values_from_result</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="c1"># Revoking the first API Key</span>
    <span class="n">first_key</span> <span class="o">=</span> <span class="n">ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">format_str</span> <span class="o">=</span> <span class="s2">&quot;{&#39;name&#39;: &#39;</span><span class="si">{}</span><span class="s2">&#39;, &#39;uuid&#39;: &#39;</span><span class="si">{}</span><span class="s2">&#39;}&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;revoke&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">first_key</span><span class="p">),</span> <span class="s2">&quot;--format&quot;</span><span class="p">,</span> <span class="n">format_str</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">0</span>

    <span class="c1"># Running ls command with default settings. The deleted kwy should not be present in the result</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ls&quot;</span><span class="p">,</span> <span class="s2">&quot;-q&quot;</span><span class="p">])</span>
    <span class="n">ids</span> <span class="o">=</span> <span class="n">get_values_from_result</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="n">display</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="n">first_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ids</span>

    <span class="c1"># Running ls command with include_disabled. The deleted kwy should be present in the result</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ls&quot;</span><span class="p">,</span> <span class="s2">&quot;-l&quot;</span><span class="p">,</span> <span class="s2">&quot;1000&quot;</span><span class="p">,</span> <span class="s2">&quot;-q&quot;</span><span class="p">,</span> <span class="s2">&quot;--disabled&quot;</span><span class="p">])</span>
    <span class="n">ids</span> <span class="o">=</span> <span class="n">get_values_from_result</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="n">display</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ids</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="n">first_key</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">,</span> <span class="n">first_key</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>&#39;name             uuid\n8TMEGHX4WXTDGJZ  3cc3ff1c-374a-4090-bb78-742e5b3aef0a\n&#39;

&#39;510edef2-244c-49c8-b8f5-b2c3b500c51b\ne4946c54-756e-4e74-9db5-22270bd1c025\n4313caa8-8faa-42ab-8f46-bd6669d96aad\n6ad2a881-bfad-4acb-9d0b-13650e161051\na7bfc801-649e-4574-997f-0dc57bd4e8b5\n00d6b61a-62f9-425a-a514-6383b9ffb392\n6e68750d-7c2b-49f4-b2fb-0c3795ec4a32\n78837644-436a-4e4f-82d0-c875d8a72437\n835281e3-c2e1-48aa-b9d6-1e39a5f4935e\n92b2f7d5-810c-4cb0-b793-2d8932ded032\na2eaa375-a21e-47cb-8e84-eb430da6c280\n10af3501-3cbb-4735-83e7-db058746efbd\n12760028-3a05-47d3-acdc-fb650c6555c9\n804deb8b-8612-41db-a452-cbbfd87ad77d\n435f4338-5584-4ff4-b1ed-c8913b4d12d0\n1ac1b8d5-60f9-4c8f-a90f-050577e52792\n3927ceee-a4cb-43e4-9bdd-c6d607ee5060\nddeb9cb8-de35-4109-ac8e-6f863e3720ec\n06c4a094-5ee3-4c2b-adf4-c5634edf488f\nf1f62f0e-e8ce-4504-ae7d-4e9a8aa4d691\na3555e15-8d40-4b24-8858-622ca60b1e30\n216c8d62-9a3c-495e-b0ab-7edea1d1aff6\n&#39;

&quot;ids=[&#39;3d10e7f1-e2cf-4386-9fc5-a32f6af9514f&#39;, &#39;fa6aefe0-e347-40fe-9a40-c3ff203ce3c2&#39;, &#39;db1aad28-f95d-457d-82cb-24aaddc96d56&#39;, &#39;7810f834-733f-4189-8c14-bf034eef750b&#39;, &#39;8dad6cee-d5de-4409-836a-fc3f0f06cd2a&#39;, &#39;d2eda1ba-5463-49e3-a815-4bc033f02703&#39;, &#39;6e4f8e5e-5a43-40e8-baa5-4af7ebfd2333&#39;, &#39;9b0cab3d-e932-475b-bb93-74dfec41be87&#39;, &#39;d3c5e334-ce68-4444-ad3c-ed4f2c738a88&#39;, &#39;76a90be6-4535-4c70-ac2a-16df432913ca&#39;, &#39;35a317ad-0fa1-4e76-ab36-d60a9a31c235&#39;, &#39;6146ab3a-a49b-4ae3-a628-b6a31583b2d2&#39;, &#39;3cc3ff1c-374a-4090-bb78-742e5b3aef0a&#39;, &#39;510edef2-244c-49c8-b8f5-b2c3b500c51b&#39;, &#39;e4946c54-756e-4e74-9db5-22270bd1c025&#39;, &#39;4313caa8-8faa-42ab-8f46-bd6669d96aad&#39;, &#39;6ad2a881-bfad-4acb-9d0b-13650e161051&#39;, &#39;a7bfc801-649e-4574-997f-0dc57bd4e8b5&#39;, &#39;00d6b61a-62f9-425a-a514-6383b9ffb392&#39;, &#39;6e68750d-7c2b-49f4-b2fb-0c3795ec4a32&#39;, &#39;78837644-436a-4e4f-82d0-c875d8a72437&#39;, &#39;835281e3-c2e1-48aa-b9d6-1e39a5f4935e&#39;, &#39;92b2f7d5-810c-4cb0-b793-2d8932ded032&#39;, &#39;a2eaa375-a21e-47cb-8e84-eb430da6c280&#39;, &#39;10af3501-3cbb-4735-83e7-db058746efbd&#39;, &#39;12760028-3a05-47d3-acdc-fb650c6555c9&#39;, &#39;804deb8b-8612-41db-a452-cbbfd87ad77d&#39;, &#39;435f4338-5584-4ff4-b1ed-c8913b4d12d0&#39;, &#39;1ac1b8d5-60f9-4c8f-a90f-050577e52792&#39;, &#39;3927ceee-a4cb-43e4-9bdd-c6d607ee5060&#39;, &#39;ddeb9cb8-de35-4109-ac8e-6f863e3720ec&#39;, &#39;06c4a094-5ee3-4c2b-adf4-c5634edf488f&#39;, &#39;f1f62f0e-e8ce-4504-ae7d-4e9a8aa4d691&#39;, &#39;a3555e15-8d40-4b24-8858-622ca60b1e30&#39;, &#39;216c8d62-9a3c-495e-b0ab-7edea1d1aff6&#39;]&quot;

&#39;3d10e7f1-e2cf-4386-9fc5-a32f6af9514f\nfa6aefe0-e347-40fe-9a40-c3ff203ce3c2\ndb1aad28-f95d-457d-82cb-24aaddc96d56\n7810f834-733f-4189-8c14-bf034eef750b\n8dad6cee-d5de-4409-836a-fc3f0f06cd2a\nd2eda1ba-5463-49e3-a815-4bc033f02703\n6e4f8e5e-5a43-40e8-baa5-4af7ebfd2333\n9b0cab3d-e932-475b-bb93-74dfec41be87\nd3c5e334-ce68-4444-ad3c-ed4f2c738a88\n76a90be6-4535-4c70-ac2a-16df432913ca\n35a317ad-0fa1-4e76-ab36-d60a9a31c235\n6146ab3a-a49b-4ae3-a628-b6a31583b2d2\n3cc3ff1c-374a-4090-bb78-742e5b3aef0a\n510edef2-244c-49c8-b8f5-b2c3b500c51b\ne4946c54-756e-4e74-9db5-22270bd1c025\n4313caa8-8faa-42ab-8f46-bd6669d96aad\n6ad2a881-bfad-4acb-9d0b-13650e161051\na7bfc801-649e-4574-997f-0dc57bd4e8b5\n00d6b61a-62f9-425a-a514-6383b9ffb392\n6e68750d-7c2b-49f4-b2fb-0c3795ec4a32\n78837644-436a-4e4f-82d0-c875d8a72437\n835281e3-c2e1-48aa-b9d6-1e39a5f4935e\n92b2f7d5-810c-4cb0-b793-2d8932ded032\na2eaa375-a21e-47cb-8e84-eb430da6c280\n10af3501-3cbb-4735-83e7-db058746efbd\n12760028-3a05-47d3-acdc-fb650c6555c9\n804deb8b-8612-41db-a452-cbbfd87ad77d\n435f4338-5584-4ff4-b1ed-c8913b4d12d0\n1ac1b8d5-60f9-4c8f-a90f-050577e52792\n3927ceee-a4cb-43e4-9bdd-c6d607ee5060\nddeb9cb8-de35-4109-ac8e-6f863e3720ec\n06c4a094-5ee3-4c2b-adf4-c5634edf488f\nf1f62f0e-e8ce-4504-ae7d-4e9a8aa4d691\na3555e15-8d40-4b24-8858-622ca60b1e30\n216c8d62-9a3c-495e-b0ab-7edea1d1aff6\n&#39;
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Tests for revoke</span>
<span class="c1"># Testing negative scenario. Passing invalie API key id</span>

<span class="k">with</span> <span class="n">set_airt_service_token_envvar</span><span class="p">():</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;revoke&quot;</span><span class="p">,</span> <span class="n">RANDOM_UUID_FOR_TESTING</span><span class="p">])</span>

    <span class="n">display</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">assert</span> <span class="s2">&quot;No such apikey&quot;</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span>

    <span class="c1"># Testing negative scenario. Passing otp for non-mfa user</span>
    <span class="n">random_otp</span> <span class="o">=</span> <span class="mi">123456</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
        <span class="n">app</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;revoke&quot;</span><span class="p">,</span> <span class="n">RANDOM_UUID_FOR_TESTING</span><span class="p">,</span> <span class="s2">&quot;--otp&quot;</span><span class="p">,</span> <span class="n">random_otp</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="n">display</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
    <span class="k">assert</span> <span class="s2">&quot;MFA is not activated for the account&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">1</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>&#39;Error: No such apikey or not enough authorization to access the apikey.\n&#39;

&#39;Error: MFA is not activated for the account. Please pass the OTP only after activating the MFA for your account.\n&#39;
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Super user revoking other user&#39;s api_key</span>
<span class="k">with</span> <span class="n">set_airt_service_token_envvar</span><span class="p">():</span>
    <span class="c1"># List the existing API Keys</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ls&quot;</span><span class="p">,</span> <span class="s2">&quot;-q&quot;</span><span class="p">])</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="n">ids</span> <span class="o">=</span> <span class="n">get_values_from_result</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="c1"># Get details for the first API Key</span>
    <span class="n">expected_key_id</span> <span class="o">=</span> <span class="n">ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># get user id</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">user_cli_app</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;details&quot;</span><span class="p">,</span> <span class="s2">&quot;-q&quot;</span><span class="p">])</span>
    <span class="n">other_user_uuid</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>


<span class="k">with</span> <span class="n">set_airt_super_service_token_envvar</span><span class="p">():</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
        <span class="n">app</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;revoke&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">expected_key_id</span><span class="p">),</span> <span class="s2">&quot;--user&quot;</span><span class="p">,</span> <span class="n">other_user_uuid</span><span class="p">,</span> <span class="s2">&quot;-q&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
    <span class="n">actual_key_id</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="n">actual_key_id</span> <span class="o">==</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">expected_key_id</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>&#39;510edef2-244c-49c8-b8f5-b2c3b500c51b\n&#39;
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># revoke multiple keys</span>

<span class="k">with</span> <span class="n">set_airt_service_token_envvar</span><span class="p">():</span>
    <span class="c1"># Creating sample keys</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
        <span class="n">app</span><span class="p">,</span>
        <span class="p">[</span><span class="s2">&quot;create&quot;</span><span class="p">,</span> <span class="n">generate_random_name</span><span class="p">(),</span> <span class="s2">&quot;-e&quot;</span><span class="p">,</span> <span class="mi">365</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
        <span class="n">app</span><span class="p">,</span>
        <span class="p">[</span><span class="s2">&quot;create&quot;</span><span class="p">,</span> <span class="n">generate_random_name</span><span class="p">(),</span> <span class="s2">&quot;-e&quot;</span><span class="p">,</span> <span class="mi">365</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="c1"># List the existing API Keys</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ls&quot;</span><span class="p">,</span> <span class="s2">&quot;-q&quot;</span><span class="p">])</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="n">ids</span> <span class="o">=</span> <span class="n">get_values_from_result</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="c1"># Get details for the first API Key</span>
    <span class="n">first_key</span> <span class="o">=</span> <span class="n">ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">second_key</span> <span class="o">=</span> <span class="n">ids</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;revoke&quot;</span><span class="p">,</span> <span class="n">first_key</span><span class="p">,</span> <span class="n">second_key</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">first_key</span><span class="p">)</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">second_key</span><span class="p">)</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>&#39;uuid                                  name             created         expiry    disabled\ne4946c54-756e-4e74-9db5-22270bd1c025  SFFJK74O7N32MOR  24 minutes ago  None      True\n4313caa8-8faa-42ab-8f46-bd6669d96aad  IBK7RGHPPG05S4X  24 minutes ago  None      True\n&#39;
</code></pre></div>


  




                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      2022 onwards, airt.ai
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
    and 
    <a href="https://nbdev-mkdocs.airt.ai/" target="_blank" rel="noopener">
      Material for nbdev
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.indexes", "navigation.top", "search.suggest", "search.highlight", "search.share"], "search": "../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.220ee61c.min.js"></script>
      
        
          <script src="../overrides/js/extra.js"></script>
        
      
        
          <script src="../overrides/js/mathjax.js"></script>
        
      
        
          <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
        
      
        
          <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        
      
    
  </body>
</html>